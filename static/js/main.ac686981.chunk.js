(this["webpackJsonpreact-tetris"]=this["webpackJsonpreact-tetris"]||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(7),c=n.n(a),i=(n(14),n(1));n(6);function l(e){var t=Object(r.useState)(!1),n=Object(i.a)(t,2),o=n[0],a=n[1];return Object(r.useEffect)((function(){function t(t){t.key===e&&a(!0)}var n=function(t){t.key===e&&a(!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[e]),o}var u,s,f=n(8),h=n(2);function v(e,t){for(var n=[],r=0;r<t;r++)n[r]=m(e);return n}function m(e){for(var t=[],n=0;n<e;n++)t[n]=g();return t}function g(){return{color:"white",status:u.EMPTY}}function E(e,t,n,r,o,a){var c=v(o,a);if(!e)return{kind:s.FAILURE,gridState:c};for(var i=e.positions[t%e.positions.length],l=0;l<i.length;l++)for(var f=0;f<i[l].length;f++){if(1===i[l][f]){var h=l+n,m=f+r;if(h>=c.length||m>=c[l].length)return{kind:s.FAILURE,gridState:c};c[h][m]={color:e.color||"1",status:u.FULL}}}return{kind:s.SUCCESS,gridState:c}}function d(e,t){for(var n=[],r=0;r<e.length;r++){n[r]=Object(h.a)(t[r]);for(var o=0;o<e[r].length;o++)e[r][o].status!==u.EMPTY&&(n[r][o]=Object(f.a)({},e[r][o]))}return n}function b(e){for(var t=0;t<e.length;t++)if(e[t].status===u.EMPTY)return!1;return!0}function p(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)if(e[n][r].status!==u.EMPTY){if(n===t.length-1)return console.log("canShapeMoveDown1Step: no! shape is at the bottom"),!1;if(t[n+1][r].status!==u.EMPTY)return console.log("canShapeMoveDown1Step: no! there's another shape in the way"),!1}return!0}function w(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)if(e[n][r].status!==u.EMPTY&&t[n][r].status!==u.EMPTY)return!0;return!1}function S(e){return o.a.createElement("div",{className:"Score"},o.a.createElement("div",null,"Score: ",e.score),o.a.createElement("div",null,"Level: ",e.level))}function O(e){var t=e.rotateShape,n=e.moveLeft,r=e.moveDown,a=e.moveRight;return o.a.createElement("div",{className:"Controls"},o.a.createElement("div",{className:"Controls-TopRow"},o.a.createElement("button",{onClick:function(){return t()}},o.a.createElement("span",{role:"img","aria-label":"rotate arrow button (counter clockwise)"},"\ud83d\udd04"))),o.a.createElement("div",{className:"Controls-BottomRow"},o.a.createElement("button",{onClick:function(){return n()}},o.a.createElement("span",{role:"img","aria-label":"left arrow button"},"\u2b05\ufe0f")),o.a.createElement("button",{onClick:function(){return r()}},o.a.createElement("span",{role:"img","aria-label":"down arrow button"},"\u2b07\ufe0f")),o.a.createElement("button",{onClick:function(){return a()}},o.a.createElement("span",{role:"img","aria-label":"right arrow button"},"\u27a1\ufe0f"))))}function j(e){var t=e.width,n=e.height,a=e.shapes,c=e.level,f=e.gameOver,g=e.levelComplete,j=Object(r.useState)(!0),M=Object(i.a)(j,2),k=M[0],C=M[1],y=Object(r.useState)(0),L=Object(i.a)(y,2),T=L[0],R=L[1],P=Object(r.useState)(v(t,n)),Y=Object(i.a)(P,2),U=Y[0],A=Y[1],N=Object(r.useState)(0),F=Object(i.a)(N,2),I=F[0],D=F[1],G=Object(r.useState)(0),x=Object(i.a)(G,2),B=x[0],V=x[1],W=Object(r.useState)(0),J=Object(i.a)(W,2),_=J[0],q=J[1],z=Object(r.useState)(Math.floor(t/2-1)),H=Object(i.a)(z,2),$=H[0],K=H[1],Q=E(a[I],B,_,$,t,n),X=Q.gridState;function Z(){if(function(){if(0===_&&w(X,U))return!0;return!1}())console.log("Done! Game over."),C(!1),f();else{if(0===a.length||!1===p(X,U)){console.log("Active shape CAN'T move down 1 step!");var e=d(X,U);if(function(e){for(var t=e.length-1;t>=0;t--)if(b(e[t]))return!0;return!1}(e)){var n=function(e){for(var t=[],n=0,r=0;r<e.length;r++)b(e[r])?(n++,t.unshift(m(e[r].length))):t.push(Object(h.a)(e[r]));return{completeRowCount:n,grid:t}}(e);e=n.grid,R(T+10*n.completeRowCount)}A(e);var r=I+1;return D(r),void(r<a.length?(q(0),K(Math.floor(t/2-1)),V(0)):(console.log("Done! out of shapes."),C(!1),g()))}console.log("Moving active shape down."),q(_+1)}}Q.kind===s.FAILURE&&console.log("Failed to get activeShapeGridState! shapeIndex: ".concat(I,", activeShapeRow: ").concat(_," (total rows: ").concat(n,")")),function(e,t){var n=Object(r.useRef)((function(){}));Object(r.useEffect)((function(){n.current=e}),[e]),Object(r.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){a.length>0&&Z()}),k?function(e){return Math.max(Math.floor(1e3-150*Math.log(e)),200)}(c):null),Object(r.useEffect)((function(){a.length>0&&!1===k&&(1===c&&(A(v(t,n)),R(0)),q(0),K(Math.floor(t/2-1)),V(0),D(0),C(!0))}),[a]);var ee=l("ArrowLeft"),te=l("ArrowRight"),ne=l("ArrowUp"),re=l("ArrowDown");function oe(){console.log("MOVE LEFT!"),function(e,t){for(var n=0;n<e.length;n++)if(e[n][0].status!==u.EMPTY)return!1;for(var r=0;r<e.length;r++)for(var o=0;o<e[r].length;o++)if(e[r][o].status!==u.EMPTY&&t[r][o-1].status!==u.EMPTY)return!1;return!0}(X,U)&&K($-1)}function ae(){console.log("MOVE RIGHT!"),function(e,t){for(var n=0;n<e.length;n++){var r=e[n].length-1;if(e[n][r].status!==u.EMPTY)return!1}for(var o=0;o<e.length;o++)for(var a=0;a<e[o].length;a++)if(e[o][a].status!==u.EMPTY&&t[o][a+1].status!==u.EMPTY)return!1;return!0}(X,U)&&K($+1)}function ce(){console.log("Up key pressed - change shape position!");var e=B+1,r=E(a[I],e,_,$,t,n);r.kind===s.SUCCESS?!1===w(r.gridState,U)?(console.log("Rotated shape does not collide with any existing active cells!"),V(e)):console.log("Can't rotate the shape in this direction: collision!"):console.log("Can't rotate the shape in this direction: off grid!")}function ie(){console.log("MOVE DOWN!"),p(X,U)&&q(_+1)}Object(r.useEffect)((function(){ee&&oe()}),[ee]),Object(r.useEffect)((function(){te&&ae()}),[te]),Object(r.useEffect)((function(){ne&&ce()}),[ne]),Object(r.useEffect)((function(){re&&ie()}),[re]);var le=d(X,U);return o.a.createElement("div",{className:"Tetris"},o.a.createElement("div",{className:"Grid"},le.map((function(e,t){return o.a.createElement("div",{key:"row".concat(t),className:"row"},e.map((function(e,n){return o.a.createElement("div",{key:"row".concat(t,"-cell").concat(n),className:"cell",style:{backgroundColor:e.color||"white"}})})))}))),o.a.createElement(S,{level:c,score:T}),o.a.createElement(O,{rotateShape:ce,moveLeft:oe,moveDown:ie,moveRight:ae}))}!function(e){e[e.EMPTY=0]="EMPTY",e[e.FULL=1]="FULL"}(u||(u={})),function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE"}(s||(s={}));var M=[function(){return{name:"square",color:"red",positions:[[[1,1],[1,1]]]}},function(){return{name:"line",color:"blue",positions:[[[1],[1],[1],[1]],[[1,1,1,1]]]}},function(){return{name:"hockeyStick",positions:[[[0,0,1],[1,1,1]],[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]],[[1,0],[1,0],[1,1]]]}},function(){return{name:"sShape",positions:[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]]}},function(){return{name:"jShape",positions:[[[1,1,1],[0,0,1]],[[1,1],[1,0],[1,0]],[[1,0,0],[1,1,1]],[[0,1],[0,1],[1,1]]]}},function(){return{name:"zShape",positions:[[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]]}},function(){return{name:"tShape",positions:[[[0,1,0],[1,1,1]],[[0,1],[1,1],[0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]]]}}];var k=["blue","green","orange","red","pink","lightgray"];function C(e){for(var t=[],n=0;n<e;n++){var r=M[Math.floor(Math.random()*M.length)](),o=k[Math.floor(Math.random()*k.length)];r.color=o,t.push(r)}return t}function y(e){return Math.floor(30*(Math.log(e)+1))}function L(){return o.a.createElement("footer",null,o.a.createElement("a",{href:"https://github.com/blefebvre/react-tetris",target:"_blank"},"react-tetris")," ","was made by"," ",o.a.createElement("a",{href:"https://twitter.com/brucelefebvre",target:"_blank"},"@brucelefebvre"))}var T=function(e){return o.a.createElement("div",{id:"overlay",style:{display:e.active?"flex":"none"}},o.a.createElement("div",{className:"message"},e.children))};function R(){var e=Object(r.useState)(1),t=Object(i.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)([]),l=Object(i.a)(c,2),u=l[0],s=l[1],f=Object(r.useState)(!0),h=Object(i.a)(f,2),v=h[0],m=h[1],g=Object(r.useState)(!1),E=Object(i.a)(g,2),d=E[0],b=E[1];return o.a.createElement("div",{className:"App"},o.a.createElement(j,{level:n,width:10,height:15,shapes:u,gameOver:function(){b(!0)},levelComplete:function(){var e=n+1;m(!0),a(e)}}),o.a.createElement(T,{active:v},"Level ",n,". Ready? ",o.a.createElement("br",null)," ",o.a.createElement("button",{onClick:function(){m(!1),s(C(y(n)))}},"Go!")),o.a.createElement(T,{active:d},"Game over"," ",o.a.createElement("span",{role:"img","aria-label":"confounded face"},"\ud83d\ude16")," ",o.a.createElement("br",null)," ",o.a.createElement("button",{onClick:function(){b(!1),a(1),s(C(y(1)))}},"Play again?")),o.a.createElement(L,null))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},6:function(e,t,n){},9:function(e,t,n){e.exports=n(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.ac686981.chunk.js.map